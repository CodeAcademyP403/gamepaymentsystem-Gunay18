var RATING_PREFIX='rating_';var GRAPH_ENDPOINT='https://graph.crazygames.com';function setRatingButtons(slug){var rating=localStorage.getItem(RATING_PREFIX+slug);if(rating==='POSITIVE'){$("#like").addClass('liked');$("#dislike").removeClass('disliked');}else if(rating==='NEGATIVE'){$("#dislike").addClass('disliked');$("#like").removeClass('liked');}else{$("#like").removeClass('liked');$("#dislike").removeClass('disliked');}}
function updateRatingValues(slug,originalRatingValue,ratingValue){var originalNumLikes=parseInt($('#numLikes')[0].innerHTML.replace(/,/g,''));var originalNumDislikes=parseInt($('#numDislikes')[0].innerHTML.replace(/,/g,''));var numLikes=originalNumLikes;var numDislikes=originalNumDislikes;if(ratingValue==='POSITIVE'){numLikes=originalNumLikes+1;}else if(ratingValue==='NEGATIVE'){numDislikes=originalNumDislikes+1;}
if(originalRatingValue==='POSITIVE'){numLikes=originalNumLikes-1;}else if(originalRatingValue==='NEGATIVE'){numDislikes=originalNumDislikes-1;}
$('#numLikes').html(numLikes.toLocaleString('en-US'));$('#numDislikes').html(numDislikes.toLocaleString('en-US'));}
function getTrackPlayKey(gameSlug){return 'TRACK_'+gameSlug;}
function daysDelta(d1,d2){var t2=d2.getTime();var t1=d1.getTime();return parseInt((t2-t1)/(24*3600*1000));}
function sendTrackPlaysEvents(gameSlug,gameData){if(gameData.numPlays===1){ga('send','event','playTracking','firstPlay',{'dimension11':gameSlug,});}else{var daysSinceFirstPlay=daysDelta(new Date(gameData.firstPlayDate),new Date());if(daysSinceFirstPlay===0){ga('send','event','playTracking','sameDayReturn',{'dimension10':gameData.numPlays.toString(),'dimension11':gameSlug,});}else{ga('send','event','playTracking','return',{'dimension10':gameData.numPlays.toString(),'dimension12':daysSinceFirstPlay.toString(),'dimension11':gameSlug,});}}}
function trackPlays(gameSlug){var gameDataString=localStorage.getItem(getTrackPlayKey(gameSlug));var gameData;if(gameDataString){gameData=JSON.parse(gameDataString);gameData.numPlays+=1;}else{gameData={numPlays:1,firstPlayDate:new Date(),}}
setTimeout(function(){localStorage.setItem(getTrackPlayKey(gameSlug),JSON.stringify(gameData));sendTrackPlaysEvents(gameSlug,gameData);},20*1000);}
var readMoreVisible=false;function toggleReadMore(gameSlug){var readMoreElement=document.getElementById('read-more');if(readMoreVisible){readMoreElement.style.display='none';showReadMoreLink(gameSlug);}else{readMoreElement.style.display='inline';hideReadMoreLink(gameSlug);}
readMoreVisible=!readMoreVisible;}
function showReadMoreLink(gameSlug){var readMoreLink=document.getElementById('read-more-link');readMoreLink.style.display='inline';ga('send','event','readMoreLink','showLessText',{'dimension11':gameSlug,});}
function hideReadMoreLink(gameSlug){var readMoreLink=document.getElementById('read-more-link');readMoreLink.style.display='none';ga('send','event','readMoreLink','showMoreText',{'dimension11':gameSlug,});}
function attachReadMore(gameSlug){var readMoreLink=document.getElementById('read-more-link');var readLessLink=document.getElementById('read-less-link');var toggleFn=function(ev){ev.preventDefault();toggleReadMore(gameSlug);};if(readMoreLink){readMoreLink.onclick=toggleFn;}
if(readLessLink){readLessLink.onclick=toggleFn;}}
$(document).ready(function(){var gameSlug=$('#like').attr('data-game');setRatingButtons(gameSlug);$(".ratingButton").click(function(event){event.preventDefault();makeInvisible('embedBox');makeInvisible('shareBox');$this=$(this);var buttonId=$this.attr("id");var ratingValue=buttonId==='like'?'POSITIVE':'NEGATIVE';var originalRatingValue=localStorage.getItem(RATING_PREFIX+gameSlug);if(originalRatingValue===ratingValue){ratingValue='CANCEL';}
localStorage.setItem(RATING_PREFIX+gameSlug,ratingValue);$.ajax({type:'POST',url:GRAPH_ENDPOINT,data:JSON.stringify({query:"mutation castVote($input: VoteInput!) { public { castVote(input: $input) } }",variables:{input:{slug:gameSlug,value:ratingValue}},operationName:"castVote"}),contentType:"application/json",dataType:'json'}).done(function(){setRatingButtons(gameSlug);updateRatingValues(gameSlug,originalRatingValue,ratingValue)
segmentTrack("Rated",{gameSlug:gameSlug,rating:ratingValue,});}).fail(function(e){console.log('rating failed:',e)});});function makeInvisible(elemName){var elem=$('#'+elemName);elem.addClass('invisible');elem.removeClass('visible');}
function makeVisible(elemName){var elem=$('#'+elemName);elem.addClass('visible');elem.removeClass('invisible');}
$('#shareBoxCloseLink').on("click",function(event){event.preventDefault();makeInvisible('shareBox');});$('#embedBoxCloseLink').on("click",function(event){event.preventDefault();makeInvisible('embedBox');});$("#share-button").on("click",function(event){event.preventDefault();makeInvisible('embedBox');if($("#shareBox").hasClass('visible')){makeInvisible('shareBox');}else{makeVisible('shareBox');segmentTrack("OpenedShareBox",{gameSlug:gameSlug,});}});$("#embed-button").on("click",function(event){event.preventDefault();makeInvisible('shareBox');if($("#embedBox").hasClass('visible')){makeInvisible('embedBox');}else{makeVisible('embedBox');if(USE_SEGMENT){analytics.track("OpenedEmbedBox",{gameSlug:gameSlug,});}}});$("#copyShareButton").on("click",function(event){event.preventDefault();$("#shareUrl").focus();$("#shareUrl").select();document.execCommand('Copy');});$("#copyEmbedButton").on("click",function(event){event.preventDefault();$("#embedCode").focus();$("#embedCode").select();document.execCommand('Copy');});$("#addthistoyourwebsite").on("click",function(event){event.preventDefault();$("div#game-addthis-box").slideDown(500);});$("#close-addthis-box").on("click",function(event){event.preventDefault();$("div#game-addthis-box").slideUp();});function asyncLoadScript(u,c){var d=document,t='script',o=d.createElement(t),s=d.getElementsByTagName(t)[0];o.src=u;if(c){o.addEventListener('load',function(e){c(null,e);},false);}
s.parentNode.insertBefore(o,s);}
var nextArrow=document.getElementById('nextArrow');var prevArrow=document.getElementById('prevArrow');function calculateTopRelatedGameTiles(width){return Math.floor(width/146);};function setUpSlick(){var slick=$('#topRelated').slick({dots:false,speed:300,centerMode:false,variableWidth:true,draggable:false,arrows:true,infinite:false,slidesToScroll:7,nextArrow:nextArrow,prevArrow:prevArrow,});setTimeout(function(){var topRelated=$('#topRelated');var slidesToScroll=calculateTopRelatedGameTiles(topRelated.width())
slick.slick('slickSetOption','slidesToScroll',slidesToScroll);topRelated.on('beforeChange',function(event,slickParam,currentSlide,nextSlide){if(nextSlide===0){prevArrow.style.visibility='hidden';}else{prevArrow.style.visibility='visible';}
ga('send','event','topRelatedSlick','click',{'dimension11':gameSlug,});});},1500);}
asyncLoadScript('https://cdnjs.cloudflare.com/ajax/libs/slick-carousel/1.8.1/slick.min.js',setUpSlick);trackPlays(gameSlug);attachReadMore(gameSlug);});